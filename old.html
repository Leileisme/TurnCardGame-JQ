<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>解救愛麗絲</title>
  <link rel="icon" href="./images/alice_logo.png">

  <link rel="stylesheet" href="./CSS/style.css">
  <link rel="stylesheet" href="./CSS/poker.css">
  <link rel="stylesheet" href="./CSS/pokerMove.css">
  <link rel="stylesheet" href="./CSS/animation.css">


  <style>
    @font-face {
      font-family: '俐方體11號';
      src: url(./font/Cubic_11_1.010_R.ttf);
    }
  </style>url()
</head>

<body>

  <div id="game"></div>

  <div id="content">
    <!-- 解救愛麗絲 title -->
    <div id="title">
      <div id="title1">解救</div><br>
      <div id="title2">愛麗絲</div>
    </div>

    <!-- 開始按鈕 -->
    <input type="button" id="start_btn" value="START">

    <!-- 愛麗絲 -->
    <div id="Alice">
      <img src="./images/alice.png">
    </div>

    <!-- 救援倒數 -->
    <div id="backTime">
      <span id="helpText">救援<br>倒數</span><br>
      <span id="timeNumber">30</span>
      <span id="sec">/秒</span>
    </div>
  </div>

  <!-- 遊戲說明也許可以用跳的 -->
  <div id="rule">
    愛麗絲被撲克牌士兵團團包住了！<br>
    馬上就要錯過回家的時間了~<br>
    快點在時間內解救愛絲，讓她安心回家吧！
    <br>
    <br>
    <h3>解救任務：</h3>
    1.在 ? 秒內將相同數字的「撲克牌士兵」配對<br>
    2.小心！他們會隨機換位置！還會走動！
  </div>


  <!-- 紅桃 -->
  <!-- <div class="poker_content_heart order  rotate_-10">

    <div class="arm_heart_R"></div>
    <div class="arm2_heart_R"></div>

    <div class="arm_heart_L"></div>
    <div class="arm2_heart_L"></div>


    <div class="hand_heart_R"> </div>
    <div class="hand_heart_L"></div>


    <div class="card card_close card_heart">
      <div class="card_front_heart"></div>
      <div class="card_back_heart"></div>
    </div>

    <div class="head_heart">
      <div class="face_heart"></div>
      <div class="nose_heart"></div>
      <div class="mouth_heart"></div>
    </div>

    <div class="shoulder_heart"></div>
    <div class="shoulder02_heart"></div>

    <div class="leg_R_-10deg"></div>
    <div class="foot_heart_R_-10deg"></div>

    <div class="leg_L_-10deg"></div>
    <div class="foot_heart_L_-10deg"></div>

  </div> -->


  <!-- 黑桃 -->
  <!-- <div class="poker_content_spades order rotate_-10">
    <div class="arm_spades_R"></div>
    <div class="arm2_spades_R"></div>

    <div class="arm_spades_L"></div>
    <div class="arm2_spades_L"></div>

    <div class="hand_spades_R"> </div>
    <div class="hand_spades_L"></div>

    <div class="card card_close card_spades">
      <div class="card_front_spades"></div>
      <div class="card_back_spades"></div>
    </div>

    <div class="head_spades">
      <div class="face_spades"></div>
      <div class="nose_spades"></div>
      <div class="mouth_spades"></div>
    </div>

    <div class="shoulder_spades"></div>
    <div class="shoulder02_spades"></div>

    <div class="leg_R"></div>
    <div class="foot_spades_R"></div>

    <div class="leg_L"></div>
    <div class="foot_spades_L"></div>
  </div> -->


  </div>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js'
    integrity='sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=='
    crossorigin='anonymous'></script>

  <script>
    // 製造撲克牌人
    for (let i = 0; i < 8; i++) {
      $('#game').append(`
      <div class="poker_content_heart order   loopMove ">

      <div class="arm_heart_R"></div>
      <div class="arm2_heart_R"></div>

      <div class="arm_heart_L"></div>
      <div class="arm2_heart_L"></div>


      <div class="hand_heart_R"> </div>
      <div class="hand_heart_L"></div>

      <div class="card card_heart">
        <div class="card_front_heart"></div>
        <div class="card_back_heart"></div>
      </div>

      <div class="head_heart">
        <div class="face_heart"></div>
        <div class="nose_heart"></div>
        <div class="mouth_heart"></div>
      </div>

      <div class="shoulder_heart"></div>
      <div class="shoulder02_heart"></div>

      <div class="leg_R"></div>
      <div class="foot_heart_R"></div>

      <div class="leg_L"></div>
      <div class="foot_heart_L"></div>

      </div>`)
      $('#game').append(`

      <div class="poker_content_spades order  loopMove ">
    <div class="arm_spades_R"></div>
    <div class="arm2_spades_R"></div>

    <div class="arm_spades_L"></div>
    <div class="arm2_spades_L"></div>

    <div class="hand_spades_R"> </div>
    <div class="hand_spades_L"></div>

    <div class="card card_spades">
      <div class="card_front_spades"></div>
      <div class="card_back_spades"></div>
    </div>

    <div class="head_spades">
      <div class="face_spades"></div>
      <div class="nose_spades"></div>
      <div class="mouth_spades"></div>
    </div>

    <div class="shoulder_spades"></div>
    <div class="shoulder02_spades"></div>

    <div class="leg_R"></div>
    <div class="foot_spades_R"></div>

    <div class="leg_L"></div>
    <div class="foot_spades_L"></div>
  </div>`)
    }

    //  把數字給撲克牌 ： setting 基本場面
    $('.card_heart').each(function (index) {
      const number = index % 8 + 1
      console.log(index, number)
      $(this).find('.card_front_heart').css('background-image', `url(./images/cards/${number}H.jpg)`)
      $(this).parents('.order').attr('data_number', number)
    })

    $('.card_spades').each(function (index) {
      const number = index % 8 + 1
      console.log(index, number)
      $(this).find('.card_front_spades').css('background-image', `url(./images/cards/${number}S.jpg)`)
      $(this).parents('.order').attr('data_number', number)
    })


    // 點擊開始遊戲
    let canclick = false
    $('#start_btn').click(function () {
      $(this).attr('disabled', true)

      canclick = false

      // 遊戲時間
      let time = 90

      // 遊戲時間個位數：位置校正
      if (time < 10) {
        $('#timeNumber').css('left', '85px')
      }
      $('#timeNumber').text(time)
      $('#timeNumber').css('display', 'block')
      $('#helpText').css('opacity', '0.5')

      // 打亂
      for (let i = 0; i < 20; i++) {
        const randomA = Math.round(Math.random() * 15)
        const randomB = Math.round(Math.random() * 15)
        $('.order').eq(randomA).insertAfter($('.order').eq(randomB))
      }

      let animationTime = 20

      // 翻牌配對+勝利條件
      setTimeout(function () {
        canclick = true
      }, 3500)



      // 倒數前的前置動作
      setTimeout(function () {

        // 讓紅桃腳動
        $('.poker_content_heart').find('.leg_R').toggleClass('leg_R_-10deg')
        $('.poker_content_heart').find('.leg_L').toggleClass('leg_L_-10deg')
        $('.foot_heart_R').toggleClass('foot_heart_R_-10deg')
        $('.foot_heart_L').toggleClass('foot_heart_L_-10deg')

        // 卡片翻面
        $('.card').addClass('card_close')

        // 行走動畫、卡牌左右搖擺、左邊退場
        setTimeout(function () {
          $('.order').addClass('rotate_-10')
          $('.order').addClass('loopMove_preGame')
        }, 2000)

        // 卡牌退場後移動到右邊看不見處
        setTimeout(function () {
          $('.order').css('left', '120%')
        }, 7900)

        // 換從右到左的行走動畫(無限循環)
        setTimeout(function () {
          $('.order').removeClass('loopMove_preGame')
          $('.order').addClass('loopMove_game')
        }, 8000)


        // 開始行走後：開始倒數
        setTimeout(function () {
          // 開始倒數
          let timer = setInterval(() => {
            time--
            $('#timeNumber').text(time)

            if (time < 10) {
              $('#timeNumber').css('left', '85px')
            }


            if (time === 0) {
              // 時間復原
              clearInterval(timer)
              // 倒數秒數消失
              $('#timeNumber').css('display', 'none')
              // 打開遊戲紐
              $('#start_btn').attr('disabled', false)
              // 清空遊戲區
              $('#game').empty()
              // 「救援倒數」字透明度恢復
              $('#helpText').css('opacity', '1')
              // 跳訊息
              setTimeout(function () {
                alert('解救失敗')
              }, 100)

              // 把倒數數字位置回歸
              $('#timeNumber').css('left', '36px')
              // 回復初始預設狀態
              // 製造撲克牌人
              for (let i = 0; i < 8; i++) {
                $('#game').append(`
                  <div class="poker_content_heart order   loopMove ">
                  
                  <div class="arm_heart_R"></div>
                  <div class="arm2_heart_R"></div>
                  
                  <div class="arm_heart_L"></div>
                  <div class="arm2_heart_L"></div>
                  
                  
                  <div class="hand_heart_R"> </div>
                  <div class="hand_heart_L"></div>
                  
                  <div class="card card_heart">
                    <div class="card_front_heart"></div>
                    <div class="card_back_heart"></div>
                  </div>
                
                  <div class="head_heart">
                    <div class="face_heart"></div>
                    <div class="nose_heart"></div>
                    <div class="mouth_heart"></div>
                  </div>
                
                  <div class="shoulder_heart"></div>
                  <div class="shoulder02_heart"></div>
                
                  <div class="leg_R"></div>
                  <div class="foot_heart_R"></div>
                
                  <div class="leg_L"></div>
                  <div class="foot_heart_L"></div>
                
                  </div>`)
                $('#game').append(`

                  <div class="poker_content_spades order  loopMove ">
                  <div class="arm_spades_R"></div>
                  <div class="arm2_spades_R"></div>
                  
                  <div class="arm_spades_L"></div>
                  <div class="arm2_spades_L"></div>
                  
                  <div class="hand_spades_R"> </div>
                  <div class="hand_spades_L"></div>
                  
                  <div class="card card_spades">
                    <div class="card_front_spades"></div>
                    <div class="card_back_spades"></div>
                  </div>
                
                  <div class="head_spades">
                    <div class="face_spades"></div>
                    <div class="nose_spades"></div>
                    <div class="mouth_spades"></div>
                  </div>
                
                  <div class="shoulder_spades"></div>
                  <div class="shoulder02_spades"></div>
                
                  <div class="leg_R"></div>
                  <div class="foot_spades_R"></div>
                
                  <div class="leg_L"></div>
                  <div class="foot_spades_L"></div>
                  </div>`)
              }

              //  把數字給撲克牌 ： setting 基本場面
              $('.card_heart').each(function (index) {
                const number = index % 8 + 1
                console.log(index, number)
                $(this).find('.card_front_heart').css('background-image', `url(./images/cards/${number}H.jpg)`)
                $(this).parents('.order').attr('data_number', number)
              })

              $('.card_spades').each(function (index) {
                const number = index % 8 + 1
                console.log(index, number)
                $(this).find('.card_front_spades').css('background-image', `url(./images/cards/${number}S.jpg)`)
                $(this).parents('.order').attr('data_number', number)
              })
            }

          }, 1000);
        }, 1500)

      }, 1500)
    })

    $('#game').on('click', '.order', function () {
      if (!canclick) return
      if (
        $('.order').find('.card:not(.card_close)').length < 2 &&
        $(this).find('.card').hasClass('card_close') &&
        !$(this).find('.card').hasClass('card_ok')
      ) {
        $(this).find('.card').removeClass('card_close')
      }

      if ($('.order').find('.card:not(.card_close)').length === 2) {
        if (
          $('.order').find('.card:not(.card_close)').parents('.order').eq(0).attr('data_number') ===
          $('.order').find('.card:not(.card_close)').parents('.order').eq(1).attr('data_number')
        ) {
          $('.order').find('.card:not(.card_close)').addClass('card_ok')
          $('.order').find('.card:not(.card_close)').parents('.order').fadeTo(1000, 0)

          // 將配對成功 opacity:0 的牌 display:none
          setTimeout(function () {
            $('.card.card_ok').parents('.order').css('display', 'none')
          }, 1000)

          // 減少動畫秒數  不會減動畫執行秒數??
          // 寫法1
          animationTime -= 2
          $('.order').each((index, element) => {
            console.log(this)
            $(this).css('animation-duration', `${animationTime}s`)
          });

          // 寫法2
          // $('.order').each((index, element) => {
          //   $(element).find('.loopMove').animate({'animation-duration':`${animationTime -= 2}s`})
          // });

        }
        setTimeout(function () {
          // 翻回來
          $('.order').find('.card:not(.card_close)').addClass('card_close')
          //  過關
          if ($('.order').find('.card_ok').length === $('.order').length)
            alert('愛麗絲救援成功!!!')
          // clearInterval(timer)
          $(this).attr('disabled', false)
        }, 1000)
      }
    })


    //  撲克牌走路動畫
    let deg = -10
    const walk_poker = () => {
      if (deg === -10) {
        $('.rotate_-10').toggleClass('rotate_10')
        $('.leg_R_-10deg').toggleClass('leg_R_10deg')
        $('.foot_heart_R_-10deg').toggleClass('foot_heart_R_10deg')
        $('.leg_L_-10deg').toggleClass('leg_L_10deg')
        $('.foot_heart_L_-10deg').toggleClass('foot_heart_L_10deg')
        deg = 10
      } else if (deg === 10) {
        $('.rotate_10').toggleClass('rotate_-10')
        $('.leg_R_10deg').toggleClass('leg_R_-10deg')
        $('.foot_heart_R_10deg').toggleClass('foot_heart_R_-10deg')
        $('.leg_L_10deg').toggleClass('leg_L_-10deg')
        $('.foot_heart_L_10deg').toggleClass('foot_heart_L_-10deg')
        deg = -10
      }
    }
    setInterval(walk_poker, 200)

  </script>
</body>

</html>